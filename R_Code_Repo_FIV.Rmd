---
title: "COMP 3021 Written Report Code Repository \n 20317937"
output:
  pdf_document:
    toc: no
    toc_depth: 2
---


```{r load-packages, include=FALSE}
library(dplyr)
library(magrittr)
library(knitr)
library(ggplot2)
library(reshape2)
library(tidyr)
library(lubridate)
library(scales)
library(tinytex)
library(readr)
```

# Loading of the data set:
Default code generated by importing from a working directory
```{r}

TDBRnew <- read_csv("C:/Users/DuFFD/Downloads/FIV Datasets/TDBRnew.csv", 
    col_types = cols(date = col_date(format = "%d/%m/%Y"), 
        new_deaths_with_positive_test = col_number(), 
        cumulative_deaths_with_positive_test = col_number(), 
        new_deaths_without_positive_test = col_number(), 
        cumulative_deaths_without_positive_test = col_number(), 
        new_deaths_total = col_number(), 
        cumulative_deaths_total = col_number()))
View(TDBRnew)

```

# Question 1
## Cleaning and Transforming the data

```{r}
Q1 <- 
    select(TDBRnew, nhs_england_region, new_deaths_total)%>%
    group_by(nhs_england_region)%>%
    mutate (sum(new_deaths_total))%>%
    rename(Total_Deaths = "sum(new_deaths_total)")%>%
    arrange(Total_Deaths)%>%
    select(-c(new_deaths_total))

Q1DF <- unique(Q1)
```

## Plotting the data
```{r}
Q1DF_plot <- ggplot(Q1DF, aes(x = reorder(nhs_england_region, -Total_Deaths), y = Total_Deaths))+             
geom_bar(stat='identity', fill = "lightcoral", colour = "lightcoral")+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)))+
theme(axis.title.x = element_text(margin = margin(t = 20, r = 0, b = 0, l = 0)))+
geom_text(aes(label = Total_Deaths), vjust = 1.2, colour = "white")+
theme(axis.text.x=element_text(angle = 90))+
xlab("NHS England Region")+
ylab("Total Deaths")+
scale_y_continuous(breaks = seq(0,20000, by = 2000))

Q1DF_plot
```






# Question 2
## Cleaning and Transforming the data
```{r}
Q2 <- 
    select(TDBRnew, nhs_england_region, new_deaths_with_positive_test,
    new_deaths_without_positive_test)%>%
    group_by(nhs_england_region)%>%
    mutate (sum(new_deaths_without_positive_test))%>%
    mutate (sum(new_deaths_with_positive_test))%>%
    rename(Positive_Test_DEATHS = "sum(new_deaths_with_positive_test)")%>%
    rename(Negative_Test_DEATHS = "sum(new_deaths_without_positive_test)")%>%
    select(-c(new_deaths_with_positive_test))%>%
    select(-c(new_deaths_without_positive_test))

Q2DF <- unique(Q2)

```

## Plotting the data

```{r}
Q2DF_plotdata <- gather(Q2DF, key = Test_Result, value = Deaths, c("Positive_Test_DEATHS", "Negative_Test_DEATHS"))
Q2DF_plot2 <- ggplot(Q2DF_plotdata, aes(x = reorder(nhs_england_region, -Deaths), y= Deaths, group = Test_Result, color = Test_Result, fill = Test_Result))+
    geom_bar(stat = "identity", position ="stack")+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
    theme(axis.text.x=element_text(angle = 90))+
    theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)))+
    theme(axis.title.x = element_text(margin = margin(t = 20, r = 0, b = 0, l = 0)))+
    ylab("Total Deaths")+
    xlab("Nhs England Region")+
    scale_y_continuous(breaks = seq(0,22000, by = 2000))

Q2DF_plot2
```





# Question 3
## Cleaning and Transforming the data

```{r}
Q3 <-
    select(TDBRnew, date, cumulative_deaths_total)%>%
    group_by(date)%>%
    summarize(sum(cumulative_deaths_total))%>%
    rename(CTD = "sum(cumulative_deaths_total)")

```

## Plotting the data
```{r}
plot3 <-
    ggplot(Q3, aes(date,CTD)) +
    geom_line(size=1, color = "lightcoral")+
    geom_area(stat="identity", fill = "lightcoral", alpha = 0.1)+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
    scale_x_date(date_labels="%b-\n%Y", date_breaks = "1 month")+
    xlab("Date")+
    ylab("Cumulative Total Deaths")+
    theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)))+
    theme(axis.title.x = element_text(margin = margin(t = 20, r = 0, b = 0, l = 0)))+
    scale_y_continuous(breaks = seq(0,95000, by = 10000))
    
plot3
```

# Question 4
## Cleaning and Transforming the data
```{r}
Q4 <-
    select(TDBRnew, date, new_deaths_total)%>%
    group_by(date)%>%
    summarize(new_deaths_total=sum(new_deaths_total))%>%
    rename(NDT = new_deaths_total)
```
## Plotting the data
```{r}
plot4 <-
    ggplot(Q4, aes(date,NDT))+
    geom_line(size=1, color = "lightcoral")+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    panel.background = element_blank(), axis.line = element_line(colour = "black"))+
    scale_x_date(date_labels="%b \n%Y", date_breaks = "1 month")+
    xlab("Date")+
    ylab("Total Daily Deaths In England")+
    theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)))+
    theme(axis.title.x = element_text(margin = margin(t = 20, r = 0, b = 0, l = 0)))+
    scale_y_continuous(breaks = seq(0,1000, by = 100))+
  
    geom_rect(data=Q4, aes(xmin=as.Date("2020-05-01","%Y-%m-%d"), xmax=as.Date("2020-07-01","%Y-%m-%d"), ymin=0, ymax=1000), fill = "lightcoral", alpha = 0.006)+
  
    geom_rect(data=Q4, aes(xmin=as.Date("2020-11-01","%Y-%m-%d"), xmax=as.Date("2020-12-01","%Y-%m-%d"), ymin=0, ymax=1000), fill = "lightcoral", alpha = 0.006)+
  
    geom_rect(data=Q4, aes(xmin=as.Date("2021-01-01","%Y-%m-%d"), xmax=as.Date("2021-03-29","%Y-%m-%d"), ymin=0, ymax=1000), fill = "lightcoral", alpha = 0.006)

plot4
```


# Question 5
## Cleaning and Transforming the data
```{r}
Q5 <-
    select(TDBRnew, date, cumulative_deaths_total, nhs_england_region)%>%
    group_by(date, nhs_england_region)%>%
    summarize(sum(cumulative_deaths_total))%>%
    rename(CTD = "sum(cumulative_deaths_total)")
```


## Plotting the data
```{r}
plot5 <-
    ggplot(Q5, aes(x=date, y=CTD), group=CTD)+
    geom_line(aes(colour=nhs_england_region), size=1)+
    theme(panel.background = element_blank(), panel.grid.major.y=element_line(size=0.25, linetype = "solid", colour = "grey88"))+
    scale_x_date(date_labels="%b \n%Y", date_breaks = "2 month")+
    scale_y_continuous(limits = c(0,25000), breaks = seq(0,20000, by = 2000))+
    xlab("Date")+
    ylab("Cumulative Total Deaths")+
    theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)))+
    theme(axis.title.x = element_text(margin = margin(t = 20, r = 0, b = 0, l = 0)))+
    labs(col="NHS England Region")

plot5
```


# Question 6
## Cleaning and Transforming the data
```{r}
Q6 <-
    select(TDBRnew, date, cumulative_deaths_per, nhs_england_region)%>%
    group_by(date, nhs_england_region)%>%
    summarize(sum(cumulative_deaths_per))%>%
    rename(CDP = "sum(cumulative_deaths_per)")

```

## Plotting the data
```{r}
plot6 <-
    ggplot(Q6, aes(x=date, y=CDP))+
    geom_line(aes(colour=nhs_england_region), size=1)+
    theme(panel.background = element_blank(), panel.grid.major.y=element_line(size=0.25, linetype = "solid", colour = "grey88"))+
    scale_x_date(date_labels="%b \n%Y", date_breaks = "2 month")+
    scale_y_continuous(limits = c(0,250), breaks = seq(0,250, by = 20))+
    xlab("Date")+
    ylab("Cumulative Total Deaths per 100,000 Population")+
    theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)))+
    theme(axis.title.x = element_text(margin = margin(t = 20, r = 0, b = 0, l = 0)))+
    labs(col="NHS England Region")

plot6
```
```{r}
Q7 <-
    select(TDBRnew, date, new_deaths_per, nhs_england_region)%>%
    group_by(date, nhs_england_region)%>%
    summarize(sum(new_deaths_per))%>%
    rename(NDP = "sum(new_deaths_per)")

```
```{r}
plot7 <-
    ggplot(Q7, aes(x=date, y=NDP))+
    geom_line(aes(colour=nhs_england_region), size=0.5)+
    theme(panel.background = element_blank(), panel.grid.major.y=element_line(size=0.25, linetype = "solid", colour = "grey88"))+
    scale_x_date(date_labels="%b \n%Y", date_breaks = "3 month")+
    scale_y_continuous(limits = c(0,3), breaks = seq(0,3, by = 0.5))+
    xlab("Date")+
    ylab("Daily Total Deaths per 100,000 Population")+
    theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)))+
    theme(axis.title.x = element_text(margin = margin(t = 20, r = 0, b = 0, l = 0)))+
    labs(col="NHS England Region")+
    facet_wrap(nhs_england_region~ .)


plot7
```